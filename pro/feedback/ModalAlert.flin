// ModalAlert.flin - FlinUI PRO Alert Modal
// Alert modal for important messages (success/error/warning/info)

// Props with defaults
isOpen = props.isOpen || false
title = props.title || ""
message = props.message || ""
variant = props.variant || "info"
buttonText = props.buttonText || "OK"
closeOnBackdrop = props.closeOnBackdrop || true
showIcon = props.showIcon || true
onClose = props.onClose

// Internal state
isClosing = false

// Handle close
handleClose = {
    isClosing = true
    if onClose { onClose() }
}

// Handle backdrop click
handleBackdropClick = {
    if closeOnBackdrop {
        handleClose()
    }
}

// Handle escape key
handleKeyDown = (event) => {
    if event.key == "Escape" {
        handleClose()
    }
}

// Variant class
variantClass = match variant {
    "success" -> "modal-alert--success"
    "warning" -> "modal-alert--warning"
    "danger" -> "modal-alert--danger"
    "error" -> "modal-alert--danger"
    _ -> "modal-alert--info"
}

// Icon paths based on variant
iconPath = match variant {
    "success" -> "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
    "warning" -> "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
    "danger" -> "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
    "error" -> "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
    _ -> "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
}

// Default titles based on variant if not provided
displayTitle = match title {
    "" -> match variant {
        "success" -> "Success"
        "warning" -> "Warning"
        "danger" -> "Error"
        "error" -> "Error"
        _ -> "Information"
    }
    _ -> title
}

// Computed classes
backdropClass = match isClosing {
    true -> "modal-alert-backdrop modal-alert-backdrop--closing"
    _ -> "modal-alert-backdrop"
}

modalClass = match isClosing {
    true -> "modal-alert " ++ variantClass ++ " modal-alert--closing"
    _ -> "modal-alert " ++ variantClass
}

containerClass = match isOpen {
    true -> "modal-alert-container"
    _ -> "modal-alert-container modal-alert-container--hidden"
}

<div class={containerClass}>
    <div
        class={backdropClass}
        click={handleBackdropClick}
        aria-hidden="true"
    ></div>

    <div
        class={modalClass}
        role="alertdialog"
        aria-modal="true"
        aria-labelledby="modal-alert-title"
        aria-describedby="modal-alert-message"
        tabindex="-1"
        keydown={handleKeyDown}
    >
        // Icon
        {if showIcon}
            <div class="modal-alert-icon-wrapper">
                <div class="modal-alert-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={iconPath} />
                    </svg>
                </div>
            </div>
        {/if}

        // Content
        <div class="modal-alert-content">
            <h3 id="modal-alert-title" class="modal-alert-title">{displayTitle}</h3>
            {if message != ""}
                <p id="modal-alert-message" class="modal-alert-message">{message}</p>
            {/if}
            {if children}
                <div class="modal-alert-body">
                    {children}
                </div>
            {/if}
        </div>

        // Action button
        <div class="modal-alert-actions">
            <button
                class="modal-alert-btn"
                click={handleClose}
                type="button"
            >
                {buttonText}
            </button>
        </div>
    </div>
</div>

<style scoped>
/* Container */
.modal-alert-container {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--flin-space-4);
}

.modal-alert-container--hidden {
    display: none;
}

/* Backdrop */
.modal-alert-backdrop {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: -1;
    animation: modalAlertBackdropIn var(--flin-transition-normal) ease-out;
}

@keyframes modalAlertBackdropIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-alert-backdrop--closing {
    animation: modalAlertBackdropOut var(--flin-transition-fast) ease-in forwards;
}

@keyframes modalAlertBackdropOut {
    to { opacity: 0; }
}

/* Modal */
.modal-alert {
    position: relative;
    background-color: var(--flin-bg);
    border-radius: var(--flin-radius-xl);
    box-shadow: var(--flin-shadow-2xl);
    width: 100%;
    max-width: 400px;
    padding: var(--flin-space-6);
    text-align: center;
    animation: modalAlertIn var(--flin-transition-normal) ease-out;
}

@keyframes modalAlertIn {
    from {
        opacity: 0;
        transform: scale(0.9) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-alert--closing {
    animation: modalAlertOut var(--flin-transition-fast) ease-in forwards;
}

@keyframes modalAlertOut {
    to {
        opacity: 0;
        transform: scale(0.9) translateY(-10px);
    }
}

/* Icon wrapper */
.modal-alert-icon-wrapper {
    display: flex;
    justify-content: center;
    margin-bottom: var(--flin-space-4);
}

.modal-alert-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    animation: modalAlertIconPulse 0.5s ease-out;
}

@keyframes modalAlertIconPulse {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.modal-alert-icon svg {
    width: 32px;
    height: 32px;
}

/* Variant icon colors */
.modal-alert--info .modal-alert-icon {
    background-color: var(--flin-info-light);
    color: var(--flin-info);
}

.modal-alert--success .modal-alert-icon {
    background-color: var(--flin-success-light);
    color: var(--flin-success);
}

.modal-alert--warning .modal-alert-icon {
    background-color: var(--flin-warning-light);
    color: var(--flin-warning);
}

.modal-alert--danger .modal-alert-icon {
    background-color: var(--flin-danger-light);
    color: var(--flin-danger);
}

/* Content */
.modal-alert-content {
    margin-bottom: var(--flin-space-5);
}

.modal-alert-title {
    margin: 0 0 var(--flin-space-2) 0;
    font-size: var(--flin-text-xl);
    font-weight: 600;
    color: var(--flin-fg);
}

.modal-alert-message {
    margin: 0;
    font-size: var(--flin-text-base);
    color: var(--flin-fg-muted);
    line-height: 1.6;
}

.modal-alert-body {
    margin-top: var(--flin-space-4);
    text-align: left;
}

/* Actions */
.modal-alert-actions {
    display: flex;
    justify-content: center;
}

/* Button - variant colored */
.modal-alert-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--flin-space-3) var(--flin-space-8);
    font-size: var(--flin-text-sm);
    font-weight: 500;
    border-radius: var(--flin-radius-lg);
    cursor: pointer;
    transition: all var(--flin-transition-fast);
    border: none;
    min-width: 120px;
}

.modal-alert-btn:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
}

/* Button colors based on variant */
.modal-alert--info .modal-alert-btn {
    background-color: var(--flin-info);
    color: white;
}

.modal-alert--info .modal-alert-btn:hover {
    background-color: var(--flin-info-active);
}

.modal-alert--success .modal-alert-btn {
    background-color: var(--flin-success);
    color: white;
}

.modal-alert--success .modal-alert-btn:hover {
    background-color: var(--flin-success-active);
}

.modal-alert--warning .modal-alert-btn {
    background-color: var(--flin-warning);
    color: white;
}

.modal-alert--warning .modal-alert-btn:hover {
    background-color: var(--flin-warning-active);
}

.modal-alert--danger .modal-alert-btn {
    background-color: var(--flin-danger);
    color: white;
}

.modal-alert--danger .modal-alert-btn:hover {
    background-color: var(--flin-danger-active);
}

/* Focus trap */
.modal-alert:focus {
    outline: none;
}

/* Mobile responsiveness */
@media (max-width: 480px) {
    .modal-alert {
        max-width: calc(100vw - var(--flin-space-8));
        padding: var(--flin-space-5);
    }

    .modal-alert-btn {
        width: 100%;
    }
}

/* Dark theme */
[data-theme="dark"] .modal-alert {
    background-color: var(--flin-neutral-900);
    border: 1px solid var(--flin-neutral-700);
}

[data-theme="dark"] .modal-alert--info .modal-alert-icon {
    background-color: rgba(6, 182, 212, 0.2);
}

[data-theme="dark"] .modal-alert--success .modal-alert-icon {
    background-color: rgba(16, 185, 129, 0.2);
}

[data-theme="dark"] .modal-alert--warning .modal-alert-icon {
    background-color: rgba(245, 158, 11, 0.2);
}

[data-theme="dark"] .modal-alert--danger .modal-alert-icon {
    background-color: rgba(239, 68, 68, 0.2);
}
</style>
